import * as React from "react";
import { withTaskContext, IconButton, styled, Actions } from "@twilio/flex-ui";
import { useSelector } from "react-redux";
import { mobilePhone as patientPhoneSelector } from "../../states/selectors";

const Button = styled.button`
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  padding: 5px 10px;
  gap: 6px;
  width: 38px;
  height: 28px;
  background: ${props => props.pressed ? '#4B5671' : '#E1E2E9'};
  border-radius: 39px;
	cursor: pointer;
	border: none;
	margin-top: 12px;
	margin-right: 6px;
  &:hover,
  &:active,
  &:focus {
    background-color: #4B5671; //rgba(0, 0, 0, 0.2);
    background-blend-mode: color;
    svg path{
      fill: white;
    }
  }
  svg path{
    fill: #626B83
  }
`;

export const CallButton = (props) => {
    const { attributes } = props.task;
    const patientNumber = useSelector(patientPhoneSelector);
    console.log("HELLO PROPS", props);
    return (
      <div>
        <Button
          onClick={() => {
            console.log("starting outbound call with attributes", attributes, patientNumber);
            Actions.invokeAction("StartOutboundCall", {
              // Payload below
              destination: patientNumber,
              taskAttributes: { ...attributes },
            });
          }}
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="14px" height="14px" viewBox="0 0 14 14">
            <path  d="M 11.339844 7.582031 C 11.210938 7.582031 11.078125 7.542969 10.949219 7.511719 C 10.6875 7.457031 10.433594 7.378906 10.183594 7.285156 C 9.914062 7.1875 9.617188 7.191406 9.351562 7.300781 C 9.082031 7.40625 8.863281 7.609375 8.738281 7.867188 L 8.609375 8.132812 C 8.042969 7.816406 7.519531 7.421875 7.058594 6.964844 C 6.601562 6.503906 6.207031 5.980469 5.890625 5.414062 L 6.136719 5.25 C 6.394531 5.121094 6.597656 4.90625 6.707031 4.636719 C 6.8125 4.371094 6.820312 4.074219 6.71875 3.804688 C 6.628906 3.554688 6.550781 3.296875 6.492188 3.039062 C 6.464844 2.910156 6.441406 2.777344 6.421875 2.640625 C 6.351562 2.230469 6.136719 1.859375 5.816406 1.59375 C 5.496094 1.328125 5.089844 1.183594 4.671875 1.191406 L 2.921875 1.191406 C 2.671875 1.1875 2.421875 1.238281 2.191406 1.339844 C 1.964844 1.445312 1.757812 1.59375 1.59375 1.785156 C 1.425781 1.972656 1.300781 2.195312 1.230469 2.433594 C 1.15625 2.675781 1.136719 2.929688 1.171875 3.179688 C 1.484375 5.621094 2.597656 7.894531 4.34375 9.632812 C 6.089844 11.371094 8.363281 12.480469 10.808594 12.78125 L 11.03125 12.78125 C 11.460938 12.78125 11.875 12.625 12.199219 12.335938 C 12.382812 12.171875 12.53125 11.96875 12.628906 11.742188 C 12.730469 11.515625 12.78125 11.273438 12.78125 11.023438 L 12.78125 9.273438 C 12.773438 8.871094 12.625 8.480469 12.363281 8.171875 C 12.101562 7.863281 11.738281 7.65625 11.339844 7.582031 Z M 11.632812 11.082031 C 11.632812 11.164062 11.613281 11.246094 11.578125 11.324219 C 11.546875 11.398438 11.496094 11.464844 11.433594 11.519531 C 11.367188 11.578125 11.292969 11.617188 11.210938 11.644531 C 11.128906 11.667969 11.039062 11.675781 10.953125 11.667969 C 8.769531 11.386719 6.742188 10.386719 5.1875 8.824219 C 3.632812 7.265625 2.644531 5.230469 2.375 3.042969 C 2.363281 2.960938 2.375 2.871094 2.398438 2.789062 C 2.421875 2.707031 2.464844 2.632812 2.519531 2.566406 C 2.574219 2.503906 2.640625 2.453125 2.71875 2.421875 C 2.792969 2.386719 2.875 2.367188 2.957031 2.367188 L 4.707031 2.367188 C 4.84375 2.363281 4.976562 2.410156 5.082031 2.492188 C 5.1875 2.578125 5.261719 2.695312 5.289062 2.828125 C 5.3125 2.988281 5.34375 3.144531 5.378906 3.300781 C 5.445312 3.609375 5.535156 3.910156 5.648438 4.207031 L 4.828125 4.585938 C 4.761719 4.617188 4.699219 4.664062 4.644531 4.71875 C 4.59375 4.773438 4.550781 4.839844 4.527344 4.914062 C 4.5 4.984375 4.488281 5.0625 4.492188 5.136719 C 4.492188 5.214844 4.511719 5.289062 4.542969 5.359375 C 5.382812 7.160156 6.828125 8.605469 8.628906 9.445312 C 8.769531 9.503906 8.929688 9.503906 9.070312 9.445312 C 9.144531 9.417969 9.210938 9.378906 9.269531 9.324219 C 9.324219 9.273438 9.371094 9.210938 9.402344 9.140625 L 9.765625 8.324219 C 10.066406 8.433594 10.375 8.519531 10.6875 8.59375 C 10.84375 8.628906 11 8.65625 11.160156 8.679688 C 11.292969 8.707031 11.410156 8.78125 11.496094 8.886719 C 11.578125 8.996094 11.625 9.128906 11.621094 9.261719 Z M 11.632812 11.082031"/>
          </svg>
        </Button>
      </div>
    );
}

export default withTaskContext(CallButton);
